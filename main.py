import streamlit as st
import py3Dmol
from st_py3dmol import showmol
import time

# --- 1. ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ ---
st.set_page_config(page_title="ุงูููุงุฑุฉ ุงูุฃุฒูุฑูุฉ - ุงููุฎุชุจุฑ ุงูุฐูู", layout="wide")

# --- 2. ูุธุงู ุชุณุฌูู ุงูุฏุฎูู ---
if 'logged_in' not in st.session_state:
    st.session_state['logged_in'] = False

def login():
    st.title("๐ ููุตุฉ ุงูููุงุฑุฉ ุงูุฃุฒูุฑูุฉ - ุงูุฏุฎูู ุงูุขูู")
    col1, col2 = st.columns([1, 1])
    with col1:
        user = st.text_input("ุงุณู ุงููุณุชุฎุฏู")
        password = st.text_input("ูููุฉ ุงููุฑูุฑ", type="password")
        if st.button("ุฏุฎูู ูููุฎุชุจุฑ"):
            if user == "admin" and password == "azhar2026": # ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
                st.session_state['logged_in'] = True
                st.rerun()
            else:
                st.error("ุฎุทุฃ ูู ุงูุจูุงูุงุช")
    st.stop()

if not st.session_state['logged_in']:
    login()

# --- 3. ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ---
with st.sidebar:
    st.header("๐ฌ ุงูุชุญูู ูู ุงูููุงุฑุฉ")
    menu = st.radio("ุงููุงุฆูุฉ:", ["ุงูุฑุฆูุณูุฉ", "ุชุฌุงุฑุจ ุงูุฐูุงุก ุงูุงุตุทูุงุนู", "ุงููุฎุชุจุฑ ุงูุชูุงุนูู 3D", "ูุฑุงุญู ุงููุดุฑูุน (10)", "ุงููุฑุงุฌุน ุงูุนุงูููุฉ"])
    st.divider()
    if st.button("ุฎุฑูุฌ"):
        st.session_state['logged_in'] = False
        st.rerun()

# --- 4. ูุญุชูู ุงูุฃูุณุงู ---

# ุฃ. ูุณู ุชุฌุงุฑุจ ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุงูุฅุถุงูุฉ ุงูุฌุฏูุฏุฉ)
if menu == "ุชุฌุงุฑุจ ุงูุฐูุงุก ุงูุงุตุทูุงุนู":
    st.header("๐ค ูุญุงูู ุงูุชุฌุงุฑุจ ุงูููููุงุฆูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู")
    st.write("ูู ุจุฎูุท ุงูุนูุงุตุฑ ุงููุงูููุฉ ูุดุงูุฏ ุงูุชูุงุนู ุงููุดุฑูุญ ุจุฑูุฌูุงู.")
    
    col1, col2 = st.columns([1, 2])
    with col1:
        st.subheader("ุฅุนุฏุงุฏ ุงูุชุฌุฑุจุฉ")
        substance_a = st.selectbox("ุงููุงุฏุฉ ุงูุฃููู (Base):", ["Silver Nitrate (AgNO3)", "Gold Ions (AuCl4)", "Carbon Atoms"])
        substance_b = st.selectbox("ุงูุนุงูู ุงููุฎุชุฒู (Reducing Agent):", ["Sodium Citrate", "Plant Extract", "Heat"])
        
        start_exp = st.button("ุจุฏุก ุงูุชุฌุฑุจุฉ ุงูุฐููุฉ")

    with col2:
        if start_exp:
            with st.spinner('ุฌุงุฑู ุชุญููู ุงูุชูุงุนู ุจูุงุกู ุนูู ุงููุฑุงุฌุน ุงูู 36...'):
                time.sleep(2) # ูุญุงูุงุฉ ููุช ุงููุนุงูุฌุฉ
                st.success("โ ุงูุชูู ุงูุชูุงุนู!")
                
                # ุดุฑุญ ุงููุชูุฌุฉ ุจูุงุก ุนูู ุงูุงุฎุชูุงุฑ
                if "Gold" in substance_a:
                    st.subheader("ุงููุชูุฌุฉ: Gold Nanoparticles (AuNPs)")
                    st.write("**ุงููุนุงุฏูุฉ:** $AuCl_4^- + 3e^- \rightarrow Au^0$")
                    st.info("๐ **ุงูุดุฑุญ ุงูุนููู:** ุชุญูู ุฃูููุงุช ุงูุฐูุจ ุฅูู ุฌุณููุงุช ูุงูููุฉ ุตูุจุฉ. ูุฐุง ุงูุชูุงุนู ูู ุฃุณุงุณ ุตูุงุนุฉ ุงููุณุชุดุนุฑุงุช ุงูุทุจูุฉ.")
                    # ุนุฑุถ ุดูู ุงูุฐูุจ ุงููุงููู
                    view = py3Dmol.view(query='cid:23985', width=600, height=300)
                    view.setStyle({'sphere': {}})
                    showmol(view)
                else:
                    st.subheader("ุงููุชูุฌุฉ: Silver Nanostructure")
                    st.write("**ุงููุนุงุฏูุฉ:** $Ag^+ + e^- \rightarrow Ag^0$")
                    st.info("๐ **ุงูุดุฑุญ ูู ุงููุฑุงุฌุน:** ุงูุฌุณููุงุช ุงููุงูููุฉ ุงููุถูุฉ ุงููุงุชุฌุฉ ุชูุชูู ุฎุตุงุฆุต ูุถุงุฏุฉ ููุจูุชูุฑูุง.")

# ุจ. ุงููุฎุชุจุฑ ุงูุชูุงุนูู 3D
elif menu == "ุงููุฎุชุจุฑ ุงูุชูุงุนูู 3D":
    st.header("๐งฌ ูุญุฏุฉ ุงููุญุงูุงุฉ ุงูุฌุฒูุฆูุฉ")
    molecule = st.selectbox("ุงุฎุชุฑ ุงูุฌุฒูุก ููุฏุฑุงุณุฉ:", ["Caffeine", "Aspirin", "Fullerene C60", "DNA"])
    
    # ุฑุจุท ุงูุฌุฒูุฆุงุช
    cids = {"Caffeine": 297, "Aspirin": 2244, "Fullerene C60": 123591, "DNA": "pdb:1BNA"}
    
    view = py3Dmol.view(query=f'{"cid" if molecule != "DNA" else ""}:{cids[molecule]}', width=800, height=400)
    view.setStyle({'stick': {'colorscheme': 'cyanCarbon'}})
    view.spin(True)
    showmol(view)
    
    st.markdown("---")
    st.subheader("๐ ุชุญููู ุงูุฎูุงุต (AI Analysis)")
    st.write(f"ุจูุงุกู ุนูู ุงููุฑุงุฌุนุ ุฌุฒูุก **{molecule}** ูุชููุฒ ุจู:")
    st.json({"ุงูุงุณุชูุฑุงุฑ ุงูุญุฑุงุฑู": "ุนุงูู", "ุงููุดุงุท ุงูููููุงุฆู": "ูุชูุณุท", "ุงูุชุทุจููุงุช": "ุทุจูุฉ/ุตูุงุนูุฉ"})

# ุฌ. ูุฑุงุญู ุงููุดุฑูุน (ุงูุตูุฑ ุงูุนุดุฑุฉ)
elif menu == "ูุฑุงุญู ุงููุดุฑูุน (10)":
    st.header("๐ผ๏ธ ูุฑุงุญู ุจูุงุก ุงูููุงุฑุฉ (ุชูุซูู ูุงูู)")
    step = st.select_slider("ุงูุชูู ุจูู ูุฑุงุญู ุงูุชูููุฐ:", options=list(range(1, 11)))
    
    c1, c2 = st.columns([3, 1])
    with c1:
        try:
            st.image(f"{step}.png", use_container_width=True)
        except:
            st.error(f"ูุฑุฌู ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงูุตูุฑุฉ {step}.png ูู ุงููุดุฑูุน.")
    with c2:
        st.write(f"### ุงููุฑุญูุฉ {step}")
        descriptions = [
            "ุฌูุน ุงููุฑุงุฌุน ุงูู 36 ูุชุญููููุง.",
            "ุจูุงุก ุงูุฎูุงุฑุฒููุฉ ุงูุจุฑูุฌูุฉ ููู AI.",
            "ุชุตููู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุชูุงุนููุฉ.",
            # ุฃุถู ููุง ุจุงูู ุงูู 10 ุฃูุตุงู
        ]
        st.write(descriptions[step-1] if step <= len(descriptions) else "ุดุฑุญ ุงููุฑุญูุฉ ูุชุงุญ ูู ุงููุฑุงุฌุน ุงููุฑููุฉ.")

# ุฏ. ุงููุฑุงุฌุน
elif menu == "ุงููุฑุงุฌุน ุงูุนุงูููุฉ":
    st.header("๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุนูููุฉ")
    st.write("ุชุญุชูู ุงูููุงุฑุฉ ุนูู 36 ูุฑุฌุนุงู ุนุงูููุงู ุชู ุชุบุฐูุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจูุง.")
    st.table({
        "ุงุณู ุงููุฑุฌุน": ["ุฃุณุงุณูุงุช ุงููุงูู", "Nature Nanotechnology", "ููููุงุก ุงูุฌุฒูุฆุงุช"],
        "ุงูุณูุฉ": [2023, 2024, 2022],
        "ุงูุญุงูุฉ": ["ูุฏูุฌ ุจุงููุงูู", "ูุฏูุฌ", "ุชุญุช ุงูุชุญููู"]
    })
